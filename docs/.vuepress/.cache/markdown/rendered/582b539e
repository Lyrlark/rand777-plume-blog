{"content":"<p>使用 <code v-pre>Vue3</code> 做一个能够通过选定的本地文件夹生成一个类似 <code v-pre>IDE</code> 左侧的文件树，同时点击文件可显示基本信息的功能。</p>\n<!-- more -->  \n<p><img src=\"/assets/24123101_01.png\" alt=\"24123101_01.png\"></p>\n<p>本项目已发布到开源仓库 <a href=\"https://github.com/zhenghaoyang24/filetree\" target=\"_blank\" rel=\"noopener noreferrer\">filetree</a>，代码对应文件为 <code v-pre>App.vue</code> 与 <code v-pre>TreeNode.vue</code>。也可以通过\n<a href=\"https://files-tree.netlify.app/\" target=\"_blank\" rel=\"noopener noreferrer\">这个链接</a>快速访问本项目。</p>\n<p>以下是对核心代码的讲解。</p>\n<h2 id=\"_1-文件处理\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-文件处理\"><span>1. 文件处理</span></a></h2>\n<p>要实现文件树最大的核心在于 <strong>解析文件夹结构</strong> 与 <strong>构建文件树</strong> 。</p>\n<h3 id=\"_1-1-定义文件树节点\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-1-定义文件树节点\"><span>1.1 定义文件树节点</span></a></h3>\n<p>文件树与数据结构中的树类似，将每个文件抽象为一个节点，节点包含 <strong>文件名、路径、子文件、折叠状态</strong>。</p>\n<div class=\"language-ts\" data-ext=\"ts\" data-title=\"ts\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">interface</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> FileItem</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">  name</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">string</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">  path</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">string</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">  children</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">?</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">FileItem</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">  collapsed</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">?</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">boolean</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n\n</div><h3 id=\"_1-2-构建文件树\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-构建文件树\"><span>1.2 构建文件树</span></a></h3>\n<p>将一个 <code v-pre>FileList</code> 对象转换成一个树形结构的 <code v-pre>FileItem</code> 数组。\n每个 <code v-pre>FileItem</code> 代表一个文件或文件夹，并包含其子文件或子文件夹。</p>\n<div class=\"language-ts line-numbers-mode\" data-ext=\"ts\" data-title=\"ts\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">buildFileTree</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">files</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">FileList</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> FileItem</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =></span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">  // 初始化根节点 其名称为 root，路径为空，子节点为空数组。</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">  const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">root</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">FileItem</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">name</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Root</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">, </span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">path</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">''</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">, </span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">children</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: []};</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">  for</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">let </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">i</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> i</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> &#x3C;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> files</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">length</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> i</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">++</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">  //遍历选中的文件夹</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">file</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> files</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">i</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">];</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">  // i = 0 为第一个子文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // 使用 webkitRelativePath 获取文件的相对路径，并将其按 / 分割成数组 pathParts。</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // 当i=0 ，pathParts为根节点第一个子文件夹的相对路径数组</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">pathParts</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> file</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">webkitRelativePath</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">split</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // currentLevel 初始化为节点的子节点数组。</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    let </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">currentLevel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> root</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">children</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">    for</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">let </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">j</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> j</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> &#x3C;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> pathParts</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">length</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> j</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">++</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">      const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">part</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> pathParts</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">j</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">      const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">existingPath</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> currentLevel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">find</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">((</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">item</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =></span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> item</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> === </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">part</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">      if</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">existingPath</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        // 如果当前路径部分已经存在，则将 currentLevel 更新为该节点的子节点数组。</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">        currentLevel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> existingPath</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">children</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> || </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">      }</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> else</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        // 如果当前路径部分不是最后一个部分（即不是文件名），则为新节点初始化一个空子节点数组。</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        // 将新节点添加到当前层级中，并将 currentLevel 更新为新节点的子节点数组。</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">        const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">newItem</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">FileItem</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">name</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">part</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">, </span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">path</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">file</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">webkitRelativePath</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">};</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        if</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">j</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> &#x3C;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> pathParts</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">length</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> - </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">          newItem</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">children</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">        }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">        currentLevel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">push</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">newItem</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">        currentLevel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> newItem</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">children</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> || </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">      }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> root</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">children</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> || </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">};</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3 id=\"_1-3-构建文件路径和-file-对象的映射\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-3-构建文件路径和-file-对象的映射\"><span>1.3 构建文件路径和 File 对象的映射</span></a></h3>\n<p>构建 <code v-pre>fileMap</code>，用于后续文件信息的展示。</p>\n<div class=\"language-ts\" data-ext=\"ts\" data-title=\"ts\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">buildFileMap</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">files</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">FileList</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =></span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">  fileMap</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">value</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> = {};</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">  for</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">let </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">i</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> i</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> &#x3C;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> files</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">length</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> i</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">++</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">file</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> files</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">i</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // 将文件路径作为键，文件对象作为值</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">    fileMap</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">value</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">file</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">webkitRelativePath</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> file</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">};</span></span></code></pre>\n\n</div><h3 id=\"_1-4-处理文件夹选择\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-4-处理文件夹选择\"><span>1.4 处理文件夹选择</span></a></h3>\n<p><code v-pre>handleFolderSelect</code> 方法绑定在 <code v-pre>input[type=file]</code> 中。</p>\n<div class=\"language-ts line-numbers-mode\" data-ext=\"ts\" data-title=\"ts\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// fileTree 对象</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">fileTree</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> ref</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">FileItem</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[]>([]);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// fileMap</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">fileMap</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> ref</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Record</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">string</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> File</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>>({});</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> // 存储文件路径和 File 对象的映射</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// 处理文件夹选择</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">handleFolderSelect</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">event</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Event</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =></span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">  const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">input</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> event</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">target</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> as</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> HTMLInputElement</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">input</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">files</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> !== null &#x26;&#x26; </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">input</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">files</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">length</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> ></span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">    fileInfo</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">value</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> null</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // 提取选中的文件夹的名称（根文件夹名）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">    selFolderName</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">value</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> input</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">files</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">].</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">webkitRelativePath</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">split</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)[</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">    fileTree</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">value</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> buildFileTree</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">input</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">files</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // 构建文件树</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    buildFileMap</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">input</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">files</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">  </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">};</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2 id=\"_2-文件树组件\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-文件树组件\"><span>2. 文件树组件</span></a></h2>\n<p>文件树组件 <code v-pre>TreeNode</code> 对传入的 <code v-pre>fileTree</code> 和 <code v-pre>fileMap</code> 进行递归渲染。<br>\n文件树 props ：</p>\n<div class=\"language-ts\" data-ext=\"ts\" data-title=\"ts\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">props</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> defineProps</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">    files</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">FileItem</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">    fileMap</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Record</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">string</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">, </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">File</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> // 用于存储文件路径和 File 对象的映射</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}>();</span></span></code></pre>\n\n</div><p><strong>TreeNode.vue ：</strong></p>\n<div class=\"language-vue line-numbers-mode\" data-ext=\"vue\" data-title=\"vue\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">template</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  &#x3C;</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">ul</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    &#x3C;</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">li</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> v-for</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">item in files</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> :key</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">item.path</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">      &#x3C;</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">div</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> class</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">file-item</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">           @click</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">handleItemClick(item)</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">      ></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">        &#x3C;</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">span</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> class</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">file-item-name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">{{ item.name }}</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">span</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">        &#x3C;</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">span</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> v-if</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">item.children</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> class</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">file-item-label</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">          &#x3C;</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">span</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> class</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">file-item-length</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">{{ item.children.length }}</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">span</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">        &#x3C;/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">span</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">      &#x3C;/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">div</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">      &#x3C;</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">TreeNode</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">          v-if</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">item.children &#x26;&#x26; !item.collapsed</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">          :files</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">item.children</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">          :fileMap</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">fileMap</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">      /></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    &#x3C;/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">li</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  &#x3C;/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">ul</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">template</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>因为还需要根据 <strong>文件后缀匹配文件图标</strong> ，同时文件夹需要能够 <strong>折叠/展开</strong>，因此还需进行 <code v-pre>collapsed</code> 判断。\n图标使用 <code v-pre>iconify</code> ,通过 <code v-pre>&lt;Icon icon=&quot;iconname&quot;/&gt;</code> 进行图标渲染。</p>\n<div class=\"language-ts line-numbers-mode\" data-ext=\"ts\" data-title=\"ts\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// icon 对象</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">interface</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> IconConfig</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">  type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">string</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> // 文件后缀</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">  icon</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">string</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> // 图标</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// 获取icon</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">getFileIcon</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">filename</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">string</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> string</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> |</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> undefined </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=></span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// 获取文件后缀</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">fileExtension</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> filename</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">split</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">.</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">pop</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()?.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">toLowerCase</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // 在 icon.json 中查找对应的图标</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">iconConfig</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> icons</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">find</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">((</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">icon</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">IconConfig</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =></span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> icon</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">type</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> === </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">fileExtension</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // 返回图标，如果未找到则返回 默认图标</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> iconConfig</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ? </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">iconConfig</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">icon</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> : </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">flat-color-icons:document</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p><code v-pre>icons.find()</code> 的 <code v-pre>icons</code> 来源于自定义的 <code v-pre>icon.json</code> ：</p>\n<div class=\"language-json line-numbers-mode\" data-ext=\"json\" data-title=\"json\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">type</span><span style=\"--shiki-light:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">pdf</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">icon</span><span style=\"--shiki-light:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">vscode-icons:file-type-pdf2</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">type</span><span style=\"--shiki-light:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">md</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">icon</span><span style=\"--shiki-light:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">skill-icons:markdown-dark</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">type</span><span style=\"--shiki-light:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">docx</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">icon</span><span style=\"--shiki-light:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">vscode-icons:file-type-word</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div>","env":{"base":"/","filePath":"G:/200-Project/hoey-blog-plume/docs/技文/24123101.md","filePathRelative":"技文/24123101.md","frontmatter":{"title":"Vue3+Ts 模仿一个 IDE 中的文件树","createTime":"2024/12/31","tags":["Vue","TypeScript"],"permalink":"/article/24123101/"},"sfcBlocks":{"template":{"type":"template","content":"<template><p>使用 <code v-pre>Vue3</code> 做一个能够通过选定的本地文件夹生成一个类似 <code v-pre>IDE</code> 左侧的文件树，同时点击文件可显示基本信息的功能。</p>\n<!-- more -->  \n<p><img src=\"/assets/24123101_01.png\" alt=\"24123101_01.png\"></p>\n<p>本项目已发布到开源仓库 <a href=\"https://github.com/zhenghaoyang24/filetree\" target=\"_blank\" rel=\"noopener noreferrer\">filetree</a>，代码对应文件为 <code v-pre>App.vue</code> 与 <code v-pre>TreeNode.vue</code>。也可以通过\n<a href=\"https://files-tree.netlify.app/\" target=\"_blank\" rel=\"noopener noreferrer\">这个链接</a>快速访问本项目。</p>\n<p>以下是对核心代码的讲解。</p>\n<h2 id=\"_1-文件处理\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-文件处理\"><span>1. 文件处理</span></a></h2>\n<p>要实现文件树最大的核心在于 <strong>解析文件夹结构</strong> 与 <strong>构建文件树</strong> 。</p>\n<h3 id=\"_1-1-定义文件树节点\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-1-定义文件树节点\"><span>1.1 定义文件树节点</span></a></h3>\n<p>文件树与数据结构中的树类似，将每个文件抽象为一个节点，节点包含 <strong>文件名、路径、子文件、折叠状态</strong>。</p>\n<div class=\"language-ts\" data-ext=\"ts\" data-title=\"ts\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">interface</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> FileItem</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">  name</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">string</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">  path</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">string</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">  children</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">?</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">FileItem</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">  collapsed</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">?</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">boolean</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n\n</div><h3 id=\"_1-2-构建文件树\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-构建文件树\"><span>1.2 构建文件树</span></a></h3>\n<p>将一个 <code v-pre>FileList</code> 对象转换成一个树形结构的 <code v-pre>FileItem</code> 数组。\n每个 <code v-pre>FileItem</code> 代表一个文件或文件夹，并包含其子文件或子文件夹。</p>\n<div class=\"language-ts line-numbers-mode\" data-ext=\"ts\" data-title=\"ts\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">buildFileTree</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">files</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">FileList</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> FileItem</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =></span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">  // 初始化根节点 其名称为 root，路径为空，子节点为空数组。</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">  const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">root</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">FileItem</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">name</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Root</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">, </span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">path</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">''</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">, </span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">children</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: []};</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">  for</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">let </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">i</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> i</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> &#x3C;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> files</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">length</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> i</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">++</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">  //遍历选中的文件夹</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">file</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> files</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">i</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">];</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">  // i = 0 为第一个子文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // 使用 webkitRelativePath 获取文件的相对路径，并将其按 / 分割成数组 pathParts。</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // 当i=0 ，pathParts为根节点第一个子文件夹的相对路径数组</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">pathParts</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> file</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">webkitRelativePath</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">split</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // currentLevel 初始化为节点的子节点数组。</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    let </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">currentLevel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> root</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">children</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">    for</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">let </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">j</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> j</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> &#x3C;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> pathParts</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">length</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> j</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">++</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">      const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">part</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> pathParts</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">j</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">      const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">existingPath</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> currentLevel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">find</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">((</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">item</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =></span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> item</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> === </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">part</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">      if</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">existingPath</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        // 如果当前路径部分已经存在，则将 currentLevel 更新为该节点的子节点数组。</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">        currentLevel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> existingPath</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">children</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> || </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">      }</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> else</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        // 如果当前路径部分不是最后一个部分（即不是文件名），则为新节点初始化一个空子节点数组。</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        // 将新节点添加到当前层级中，并将 currentLevel 更新为新节点的子节点数组。</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">        const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">newItem</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">FileItem</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">name</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">part</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">, </span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">path</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">file</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">webkitRelativePath</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">};</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        if</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">j</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> &#x3C;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> pathParts</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">length</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> - </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">          newItem</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">children</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">        }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">        currentLevel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">push</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">newItem</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">        currentLevel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> newItem</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">children</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> || </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">      }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> root</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">children</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> || </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">};</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3 id=\"_1-3-构建文件路径和-file-对象的映射\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-3-构建文件路径和-file-对象的映射\"><span>1.3 构建文件路径和 File 对象的映射</span></a></h3>\n<p>构建 <code v-pre>fileMap</code>，用于后续文件信息的展示。</p>\n<div class=\"language-ts\" data-ext=\"ts\" data-title=\"ts\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">buildFileMap</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">files</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">FileList</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =></span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">  fileMap</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">value</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> = {};</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">  for</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">let </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">i</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> i</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> &#x3C;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> files</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">length</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> i</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">++</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">file</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> files</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">i</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // 将文件路径作为键，文件对象作为值</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">    fileMap</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">value</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">file</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">webkitRelativePath</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> file</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">};</span></span></code></pre>\n\n</div><h3 id=\"_1-4-处理文件夹选择\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-4-处理文件夹选择\"><span>1.4 处理文件夹选择</span></a></h3>\n<p><code v-pre>handleFolderSelect</code> 方法绑定在 <code v-pre>input[type=file]</code> 中。</p>\n<div class=\"language-ts line-numbers-mode\" data-ext=\"ts\" data-title=\"ts\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// fileTree 对象</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">fileTree</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> ref</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">FileItem</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[]>([]);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// fileMap</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">fileMap</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> ref</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Record</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">string</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> File</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>>({});</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> // 存储文件路径和 File 对象的映射</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// 处理文件夹选择</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">handleFolderSelect</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">event</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Event</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =></span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">  const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">input</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> event</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">target</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> as</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> HTMLInputElement</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">input</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">files</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> !== null &#x26;&#x26; </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">input</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">files</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">length</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> ></span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">    fileInfo</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">value</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> null</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // 提取选中的文件夹的名称（根文件夹名）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">    selFolderName</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">value</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> input</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">files</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">].</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">webkitRelativePath</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">split</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)[</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">    fileTree</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">value</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> buildFileTree</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">input</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">files</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // 构建文件树</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    buildFileMap</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">input</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">files</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">  </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">};</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2 id=\"_2-文件树组件\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-文件树组件\"><span>2. 文件树组件</span></a></h2>\n<p>文件树组件 <code v-pre>TreeNode</code> 对传入的 <code v-pre>fileTree</code> 和 <code v-pre>fileMap</code> 进行递归渲染。<br>\n文件树 props ：</p>\n<div class=\"language-ts\" data-ext=\"ts\" data-title=\"ts\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">props</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> defineProps</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">    files</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">FileItem</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">    fileMap</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Record</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">string</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">, </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">File</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> // 用于存储文件路径和 File 对象的映射</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}>();</span></span></code></pre>\n\n</div><p><strong>TreeNode.vue ：</strong></p>\n<div class=\"language-vue line-numbers-mode\" data-ext=\"vue\" data-title=\"vue\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">template</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  &#x3C;</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">ul</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    &#x3C;</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">li</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> v-for</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">item in files</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> :key</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">item.path</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">      &#x3C;</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">div</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> class</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">file-item</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">           @click</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">handleItemClick(item)</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">      ></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">        &#x3C;</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">span</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> class</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">file-item-name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">{{ item.name }}</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">span</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">        &#x3C;</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">span</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> v-if</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">item.children</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> class</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">file-item-label</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">          &#x3C;</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">span</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> class</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">file-item-length</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">{{ item.children.length }}</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">span</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">        &#x3C;/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">span</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">      &#x3C;/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">div</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">      &#x3C;</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">TreeNode</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">          v-if</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">item.children &#x26;&#x26; !item.collapsed</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">          :files</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">item.children</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">          :fileMap</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">fileMap</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">      /></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    &#x3C;/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">li</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  &#x3C;/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">ul</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">template</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>因为还需要根据 <strong>文件后缀匹配文件图标</strong> ，同时文件夹需要能够 <strong>折叠/展开</strong>，因此还需进行 <code v-pre>collapsed</code> 判断。\n图标使用 <code v-pre>iconify</code> ,通过 <code v-pre>&lt;Icon icon=&quot;iconname&quot;/&gt;</code> 进行图标渲染。</p>\n<div class=\"language-ts line-numbers-mode\" data-ext=\"ts\" data-title=\"ts\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// icon 对象</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">interface</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> IconConfig</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">  type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">string</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> // 文件后缀</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">  icon</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">string</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> // 图标</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// 获取icon</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">getFileIcon</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">filename</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">string</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> string</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> |</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> undefined </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=></span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// 获取文件后缀</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">fileExtension</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> filename</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">split</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">.</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">pop</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()?.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">toLowerCase</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // 在 icon.json 中查找对应的图标</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">iconConfig</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> icons</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">find</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">((</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">icon</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">IconConfig</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =></span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> icon</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">type</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> === </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">fileExtension</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // 返回图标，如果未找到则返回 默认图标</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> iconConfig</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ? </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">iconConfig</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">icon</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> : </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">flat-color-icons:document</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p><code v-pre>icons.find()</code> 的 <code v-pre>icons</code> 来源于自定义的 <code v-pre>icon.json</code> ：</p>\n<div class=\"language-json line-numbers-mode\" data-ext=\"json\" data-title=\"json\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">type</span><span style=\"--shiki-light:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">pdf</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">icon</span><span style=\"--shiki-light:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">vscode-icons:file-type-pdf2</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">type</span><span style=\"--shiki-light:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">md</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">icon</span><span style=\"--shiki-light:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">skill-icons:markdown-dark</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">type</span><span style=\"--shiki-light:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">docx</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">icon</span><span style=\"--shiki-light:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">vscode-icons:file-type-word</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></template>","contentStripped":"<p>使用 <code v-pre>Vue3</code> 做一个能够通过选定的本地文件夹生成一个类似 <code v-pre>IDE</code> 左侧的文件树，同时点击文件可显示基本信息的功能。</p>\n<!-- more -->  \n<p><img src=\"/assets/24123101_01.png\" alt=\"24123101_01.png\"></p>\n<p>本项目已发布到开源仓库 <a href=\"https://github.com/zhenghaoyang24/filetree\" target=\"_blank\" rel=\"noopener noreferrer\">filetree</a>，代码对应文件为 <code v-pre>App.vue</code> 与 <code v-pre>TreeNode.vue</code>。也可以通过\n<a href=\"https://files-tree.netlify.app/\" target=\"_blank\" rel=\"noopener noreferrer\">这个链接</a>快速访问本项目。</p>\n<p>以下是对核心代码的讲解。</p>\n<h2 id=\"_1-文件处理\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-文件处理\"><span>1. 文件处理</span></a></h2>\n<p>要实现文件树最大的核心在于 <strong>解析文件夹结构</strong> 与 <strong>构建文件树</strong> 。</p>\n<h3 id=\"_1-1-定义文件树节点\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-1-定义文件树节点\"><span>1.1 定义文件树节点</span></a></h3>\n<p>文件树与数据结构中的树类似，将每个文件抽象为一个节点，节点包含 <strong>文件名、路径、子文件、折叠状态</strong>。</p>\n<div class=\"language-ts\" data-ext=\"ts\" data-title=\"ts\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">interface</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> FileItem</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">  name</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">string</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">  path</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">string</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">  children</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">?</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">FileItem</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">  collapsed</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">?</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">boolean</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n\n</div><h3 id=\"_1-2-构建文件树\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-构建文件树\"><span>1.2 构建文件树</span></a></h3>\n<p>将一个 <code v-pre>FileList</code> 对象转换成一个树形结构的 <code v-pre>FileItem</code> 数组。\n每个 <code v-pre>FileItem</code> 代表一个文件或文件夹，并包含其子文件或子文件夹。</p>\n<div class=\"language-ts line-numbers-mode\" data-ext=\"ts\" data-title=\"ts\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">buildFileTree</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">files</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">FileList</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> FileItem</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =></span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">  // 初始化根节点 其名称为 root，路径为空，子节点为空数组。</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">  const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">root</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">FileItem</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">name</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Root</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">, </span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">path</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">''</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">, </span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">children</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: []};</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">  for</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">let </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">i</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> i</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> &#x3C;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> files</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">length</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> i</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">++</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">  //遍历选中的文件夹</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">file</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> files</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">i</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">];</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">  // i = 0 为第一个子文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // 使用 webkitRelativePath 获取文件的相对路径，并将其按 / 分割成数组 pathParts。</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // 当i=0 ，pathParts为根节点第一个子文件夹的相对路径数组</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">pathParts</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> file</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">webkitRelativePath</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">split</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // currentLevel 初始化为节点的子节点数组。</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    let </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">currentLevel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> root</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">children</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">    for</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">let </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">j</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> j</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> &#x3C;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> pathParts</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">length</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> j</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">++</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">      const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">part</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> pathParts</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">j</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">      const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">existingPath</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> currentLevel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">find</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">((</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">item</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =></span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> item</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> === </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">part</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">      if</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">existingPath</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        // 如果当前路径部分已经存在，则将 currentLevel 更新为该节点的子节点数组。</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">        currentLevel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> existingPath</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">children</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> || </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">      }</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> else</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        // 如果当前路径部分不是最后一个部分（即不是文件名），则为新节点初始化一个空子节点数组。</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        // 将新节点添加到当前层级中，并将 currentLevel 更新为新节点的子节点数组。</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">        const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">newItem</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">FileItem</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">name</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">part</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">, </span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">path</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">file</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">webkitRelativePath</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">};</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        if</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">j</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> &#x3C;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> pathParts</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">length</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> - </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">          newItem</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">children</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">        }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">        currentLevel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">push</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">newItem</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">        currentLevel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> newItem</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">children</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> || </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">      }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> root</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">children</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> || </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">};</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3 id=\"_1-3-构建文件路径和-file-对象的映射\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-3-构建文件路径和-file-对象的映射\"><span>1.3 构建文件路径和 File 对象的映射</span></a></h3>\n<p>构建 <code v-pre>fileMap</code>，用于后续文件信息的展示。</p>\n<div class=\"language-ts\" data-ext=\"ts\" data-title=\"ts\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">buildFileMap</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">files</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">FileList</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =></span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">  fileMap</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">value</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> = {};</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">  for</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">let </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">i</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> i</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> &#x3C;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> files</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">length</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> i</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">++</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">file</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> files</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">i</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // 将文件路径作为键，文件对象作为值</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">    fileMap</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">value</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">file</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">webkitRelativePath</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> file</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">};</span></span></code></pre>\n\n</div><h3 id=\"_1-4-处理文件夹选择\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-4-处理文件夹选择\"><span>1.4 处理文件夹选择</span></a></h3>\n<p><code v-pre>handleFolderSelect</code> 方法绑定在 <code v-pre>input[type=file]</code> 中。</p>\n<div class=\"language-ts line-numbers-mode\" data-ext=\"ts\" data-title=\"ts\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// fileTree 对象</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">fileTree</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> ref</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">FileItem</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[]>([]);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// fileMap</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">fileMap</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> ref</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Record</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">string</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> File</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>>({});</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> // 存储文件路径和 File 对象的映射</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// 处理文件夹选择</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">handleFolderSelect</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">event</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Event</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =></span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">  const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">input</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> event</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">target</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> as</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> HTMLInputElement</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">input</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">files</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> !== null &#x26;&#x26; </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">input</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">files</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">length</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> ></span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">    fileInfo</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">value</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> null</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // 提取选中的文件夹的名称（根文件夹名）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">    selFolderName</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">value</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> input</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">files</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">].</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">webkitRelativePath</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">split</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)[</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">    fileTree</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">value</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> buildFileTree</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">input</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">files</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // 构建文件树</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    buildFileMap</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">input</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">files</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">  </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">};</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2 id=\"_2-文件树组件\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-文件树组件\"><span>2. 文件树组件</span></a></h2>\n<p>文件树组件 <code v-pre>TreeNode</code> 对传入的 <code v-pre>fileTree</code> 和 <code v-pre>fileMap</code> 进行递归渲染。<br>\n文件树 props ：</p>\n<div class=\"language-ts\" data-ext=\"ts\" data-title=\"ts\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">props</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> defineProps</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">    files</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">FileItem</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">    fileMap</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Record</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">string</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">, </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">File</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> // 用于存储文件路径和 File 对象的映射</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}>();</span></span></code></pre>\n\n</div><p><strong>TreeNode.vue ：</strong></p>\n<div class=\"language-vue line-numbers-mode\" data-ext=\"vue\" data-title=\"vue\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">template</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  &#x3C;</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">ul</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    &#x3C;</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">li</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> v-for</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">item in files</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> :key</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">item.path</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">      &#x3C;</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">div</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> class</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">file-item</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">           @click</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">handleItemClick(item)</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">      ></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">        &#x3C;</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">span</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> class</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">file-item-name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">{{ item.name }}</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">span</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">        &#x3C;</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">span</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> v-if</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">item.children</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> class</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">file-item-label</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">          &#x3C;</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">span</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> class</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">file-item-length</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">{{ item.children.length }}</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">span</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">        &#x3C;/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">span</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">      &#x3C;/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">div</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">      &#x3C;</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">TreeNode</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">          v-if</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">item.children &#x26;&#x26; !item.collapsed</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">          :files</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">item.children</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">          :fileMap</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">fileMap</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">      /></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    &#x3C;/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">li</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  &#x3C;/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">ul</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">template</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>因为还需要根据 <strong>文件后缀匹配文件图标</strong> ，同时文件夹需要能够 <strong>折叠/展开</strong>，因此还需进行 <code v-pre>collapsed</code> 判断。\n图标使用 <code v-pre>iconify</code> ,通过 <code v-pre>&lt;Icon icon=&quot;iconname&quot;/&gt;</code> 进行图标渲染。</p>\n<div class=\"language-ts line-numbers-mode\" data-ext=\"ts\" data-title=\"ts\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// icon 对象</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">interface</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> IconConfig</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">  type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">string</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> // 文件后缀</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">  icon</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">string</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> // 图标</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// 获取icon</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">getFileIcon</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">filename</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">string</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> string</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> |</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> undefined </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=></span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// 获取文件后缀</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">fileExtension</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> filename</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">split</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">.</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">pop</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()?.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">toLowerCase</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // 在 icon.json 中查找对应的图标</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    const </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">iconConfig</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> icons</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">find</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">((</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">icon</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">: </span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">IconConfig</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =></span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> icon</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">type</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> === </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">fileExtension</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // 返回图标，如果未找到则返回 默认图标</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> iconConfig</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ? </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">iconConfig</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">icon</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> : </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">flat-color-icons:document</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p><code v-pre>icons.find()</code> 的 <code v-pre>icons</code> 来源于自定义的 <code v-pre>icon.json</code> ：</p>\n<div class=\"language-json line-numbers-mode\" data-ext=\"json\" data-title=\"json\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">type</span><span style=\"--shiki-light:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">pdf</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">icon</span><span style=\"--shiki-light:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">vscode-icons:file-type-pdf2</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">type</span><span style=\"--shiki-light:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">md</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">icon</span><span style=\"--shiki-light:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">skill-icons:markdown-dark</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">type</span><span style=\"--shiki-light:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">docx</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">icon</span><span style=\"--shiki-light:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">vscode-icons:file-type-word</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div>","tagOpen":"<template>","tagClose":"</template>"},"script":null,"scriptSetup":null,"scripts":[],"styles":[],"customBlocks":[]},"content":"使用 `Vue3` 做一个能够通过选定的本地文件夹生成一个类似 `IDE` 左侧的文件树，同时点击文件可显示基本信息的功能。  \r\n\r\n<!-- more -->  \r\n\r\n![24123101_01.png](/assets/24123101_01.png)\r\n\r\n本项目已发布到开源仓库 [filetree](https://github.com/zhenghaoyang24/filetree)，代码对应文件为 `App.vue` 与 `TreeNode.vue`。也可以通过\r\n[这个链接](https://files-tree.netlify.app/)快速访问本项目。  \r\n\r\n以下是对核心代码的讲解。\r\n\r\n## 1. 文件处理\r\n要实现文件树最大的核心在于 **解析文件夹结构** 与 **构建文件树** 。\r\n\r\n### 1.1 定义文件树节点\r\n文件树与数据结构中的树类似，将每个文件抽象为一个节点，节点包含 **文件名、路径、子文件、折叠状态**。\r\n```ts\r\ninterface FileItem {\r\n  name: string;\r\n  path: string;\r\n  children?: FileItem[];\r\n  collapsed?: boolean;\r\n}\r\n```\r\n### 1.2 构建文件树\r\n将一个 `FileList` 对象转换成一个树形结构的 `FileItem` 数组。\r\n每个 `FileItem` 代表一个文件或文件夹，并包含其子文件或子文件夹。\r\n```ts\r\nconst buildFileTree = (files: FileList): FileItem[] => {\r\n  // 初始化根节点 其名称为 root，路径为空，子节点为空数组。\r\n  const root: FileItem = {name: 'Root', path: '', children: []};\r\n  for (let i = 0; i < files.length; i++) {  //遍历选中的文件夹\r\n    const file = files[i];  // i = 0 为第一个子文件\r\n    // 使用 webkitRelativePath 获取文件的相对路径，并将其按 / 分割成数组 pathParts。\r\n    // 当i=0 ，pathParts为根节点第一个子文件夹的相对路径数组\r\n    const pathParts = file.webkitRelativePath.split('/');\r\n    // currentLevel 初始化为节点的子节点数组。\r\n    let currentLevel = root.children!;\r\n    for (let j = 0; j < pathParts.length; j++) {\r\n      const part = pathParts[j];\r\n      const existingPath = currentLevel.find((item) => item.name === part);\r\n      if (existingPath) {\r\n        // 如果当前路径部分已经存在，则将 currentLevel 更新为该节点的子节点数组。\r\n        currentLevel = existingPath.children || [];\r\n      } else {\r\n        // 如果当前路径部分不是最后一个部分（即不是文件名），则为新节点初始化一个空子节点数组。\r\n        // 将新节点添加到当前层级中，并将 currentLevel 更新为新节点的子节点数组。\r\n        const newItem: FileItem = {name: part, path: file.webkitRelativePath};\r\n        if (j < pathParts.length - 1) {\r\n          newItem.children = [];\r\n        }\r\n        currentLevel.push(newItem);\r\n        currentLevel = newItem.children || [];\r\n      }\r\n    }\r\n  }\r\n  return root.children || [];\r\n};\r\n```\r\n\r\n### 1.3 构建文件路径和 File 对象的映射\r\n构建 `fileMap`，用于后续文件信息的展示。\r\n```ts\r\nconst buildFileMap = (files: FileList) => {\r\n  fileMap.value = {};\r\n  for (let i = 0; i < files.length; i++) {\r\n    const file = files[i];\r\n    // 将文件路径作为键，文件对象作为值\r\n    fileMap.value[file.webkitRelativePath] = file;\r\n  }\r\n};\r\n```\r\n### 1.4 处理文件夹选择\r\n`handleFolderSelect` 方法绑定在 `input[type=file]` 中。\r\n```ts\r\n// fileTree 对象\r\nconst fileTree = ref<FileItem[]>([]);\r\n// fileMap\r\nconst fileMap = ref<Record<string, File>>({}); // 存储文件路径和 File 对象的映射\r\n// 处理文件夹选择\r\nconst handleFolderSelect = (event: Event) => {\r\n  const input = event.target as HTMLInputElement;\r\n  if (input.files !== null && input.files.length > 0) {\r\n    fileInfo.value = null\r\n    // 提取选中的文件夹的名称（根文件夹名）\r\n    selFolderName.value = input.files[0].webkitRelativePath.split('/')[0];\r\n    fileTree.value = buildFileTree(input.files);\r\n    // 构建文件树\r\n    buildFileMap(input.files);  \r\n  }\r\n};\r\n```\r\n\r\n## 2. 文件树组件\r\n文件树组件 `TreeNode` 对传入的 `fileTree` 和 `fileMap` 进行递归渲染。  \r\n文件树 props ：\r\n```ts\r\nconst props = defineProps<{\r\n    files: FileItem[];\r\n    fileMap: Record<string, File>; // 用于存储文件路径和 File 对象的映射\r\n}>();\r\n```\r\n**TreeNode.vue ：**\r\n```vue\r\n<template>\r\n  <ul>\r\n    <li v-for=\"item in files\" :key=\"item.path\">\r\n      <div class=\"file-item\"\r\n           @click=\"handleItemClick(item)\"\r\n      >\r\n        <span class=\"file-item-name\">{{ item.name }}</span>\r\n        <span v-if=\"item.children\" class=\"file-item-label\">\r\n          <span class=\"file-item-length\">{{ item.children.length }}</span>\r\n        </span>\r\n      </div>\r\n      <TreeNode\r\n          v-if=\"item.children && !item.collapsed\"\r\n          :files=\"item.children\"\r\n          :fileMap=\"fileMap\"\r\n      />\r\n    </li>\r\n  </ul>\r\n</template>\r\n```\r\n因为还需要根据 **文件后缀匹配文件图标** ，同时文件夹需要能够 **折叠/展开**，因此还需进行 `collapsed` 判断。\r\n图标使用 `iconify` ,通过 `<Icon icon=\"iconname\"/>` 进行图标渲染。\r\n```ts\r\n// icon 对象\r\ninterface IconConfig {\r\n  type: string; // 文件后缀\r\n  icon: string; // 图标\r\n}\r\n// 获取icon\r\nconst getFileIcon = (filename: string): string | undefined => {\r\n// 获取文件后缀\r\n    const fileExtension = filename.split('.').pop()?.toLowerCase();\r\n    // 在 icon.json 中查找对应的图标\r\n    const iconConfig = icons.find((icon: IconConfig) => icon.type === fileExtension);\r\n    // 返回图标，如果未找到则返回 默认图标\r\n    return iconConfig ? iconConfig.icon : 'flat-color-icons:document';\r\n}\r\n```\r\n`icons.find()` 的 `icons` 来源于自定义的 `icon.json` ：\r\n```json\r\n[\r\n  {\r\n    \"type\": \"pdf\",\r\n    \"icon\": \"vscode-icons:file-type-pdf2\"\r\n  },\r\n  {\r\n    \"type\": \"md\",\r\n    \"icon\": \"skill-icons:markdown-dark\"\r\n  },\r\n  {\r\n    \"type\": \"docx\",\r\n    \"icon\": \"vscode-icons:file-type-word\"\r\n  }\r\n]\r\n```","excerpt":"","includedFiles":[],"tasklistId":0,"title":"","headers":[{"level":2,"title":"1. 文件处理","slug":"_1-文件处理","link":"#_1-文件处理","children":[{"level":3,"title":"1.1 定义文件树节点","slug":"_1-1-定义文件树节点","link":"#_1-1-定义文件树节点","children":[]},{"level":3,"title":"1.2 构建文件树","slug":"_1-2-构建文件树","link":"#_1-2-构建文件树","children":[]},{"level":3,"title":"1.3 构建文件路径和 File 对象的映射","slug":"_1-3-构建文件路径和-file-对象的映射","link":"#_1-3-构建文件路径和-file-对象的映射","children":[]},{"level":3,"title":"1.4 处理文件夹选择","slug":"_1-4-处理文件夹选择","link":"#_1-4-处理文件夹选择","children":[]}]},{"level":2,"title":"2. 文件树组件","slug":"_2-文件树组件","link":"#_2-文件树组件","children":[]}]}}
