---
title: 'UV：Rust重写的快速包管理器'
createTime: 2025/07/17 10:48:22
permalink: /article/20250717/
tags:
  - Python
  - Rust
  - Shell
---

[//]: # (TODO: 写一下)

前段时间，无意中了解到一个名为 `UV` 的 Rust 重写的快速包管理器，感觉非常有趣，为什么不用pip呢，各种包管理器的区别和联系、优缺点在哪里？这段时间用下来，感觉非常不错，速度快、功能强大、使用简单，版本依赖管理尤其突出。

Windows用户使用管理员模式的powershell执行下面的命令安装即可，如果有报错问问GPT就可以了，多半是权限的问题。

```shell
powershell -ExecutionPolicy ByPass -c "irm https://astral.sh/uv/install.ps1 | iex"
```

其他方式和操作系统安装参考：[https://docs.astral.sh/uv/getting-started/installation/#standalone-installer](https://docs.astral.sh/uv/getting-started/installation/#standalone-installer)

## 简单尝试

### Python管理

反正就 `uv python`+ 命令，一般是先`list`看哪些版本可以下，`find`看安装了什么版本，`install`安装，`uninstall`卸载，`pin`特定版本到项目。

安装最新版cpython
```shell 是
uv python install [版本号] --reinstall(可选，覆盖安装)
```

升级python版本
```shell
uv python upgrade
```

### 代理执行

:::note
前提是.py文件中导入的包为[标准类库](https://docs.python.org/3/library/index.html)，例如 `import os`、`import sys` 等等
:::

```shell
uv run <python文件> [参数]
```

有特定依赖项使用以下命令：

```shell
uv run <python文件> --with <依赖项> [参数]
```

### 显式声明依赖

> 2023年10月，python官方发布了[PEP 723](https://peps.python.org/pep-0723/)，引入了声明式内敛元数据以及`pyproject.toml`文件来声明项目的依赖项。

初始化
```shell
uv init --script <python文件> --python <python版本>
```

声明脚本依赖，这里向 `example.py` 文件添加了 `requests` 和 `rich` 这两个依赖项，版本限制为小于3的版本。

```shell
uv add --script example.py 'requests<3' 'rich'
```

### 修改下载地址（包索引）

如果你想使用其他镜像源，可以通过以下命令修改包索引地址：

```shell
uv add --index "https://example.com/simple" --script example.py 'requests<3' 'rich'
```

会一并写入 `pyproject.toml` 文件中。

```toml
# [[tool.uv.index]]
# url = "https://example.com/simple"
```

到这里，我们就可以看出它的长处了，可以显示定义下载源，版本依赖，甚至可以指定脚本文件。

### 锁定脚本依赖

与项目不同，脚本依赖是指特定脚本所需的依赖项。可以通过以下命令锁定脚本依赖：

```shell
uv lock --script example.py
```

生成的结构如下

@[code-tree title="Example" height="400px" entry="test.py.lock"](docs/.vuepress/public/code/20250717/test)

### 使用不同python

```shell
uv run <python文件> --python <python版本> [参数]
```


## UV工具

### uvx

只有当在无关紧要的测试、扁平化项目中用这个比较合适，`uvx` 等价于下面的命令：这样做是为了预先测试检查兼容python包版本，你知道的，python的包管理就和重庆的天气一样糟糕（

```shell
uv tool run
```

```shell
$ uvx pycowsay nb

  --
< nb >
  --
   \   ^__^
    \  (oo)\_______
       (__)\       )\/\
           ||----w |
           ||     ||

```

> 这个用的比较少，暂时写到这里。链接：[https://docs.astral.sh/uv/guides/tools/#running-tools](https://docs.astral.sh/uv/guides/tools/#running-tools)

## 项目管理

```shell
uv init hello-world
cd hello-world
```

生成的目录结构如下：

@[code-tree title="hello-world" height="400px" entry="main.py"](docs/.vuepress/public/code/20250717/hello-world)

### <Badge>常用</Badge>

### 项目结构